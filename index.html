<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ„Ø¯ ÙÙ‡Ø±Ø³ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªØ·ÙˆØ± - Ultimate Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- NEW: Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* CSS is now significantly simplified, relying on Bootstrap variables and utilities */

        /* Custom properties for reusable gradients */
        :root {
            --gradient-sitemap: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-robots: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --gradient-manifest: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-github: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
            --gradient-spa: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            --gradient-seo-crawler: linear-gradient(135deg, #5ee7df 0%, #b490ca 100%); /* New Gradient for SEO Crawler */
            --gradient-feature: linear-gradient(45deg, #28a745, #20c997);
            --gradient-pro: linear-gradient(45deg, #6f42c1, #e83e8c);
            --gradient-ultimate: linear-gradient(45deg, #fd7e14, #dc3545);
            --gradient-dark-toggle: linear-gradient(45deg, #667eea, #764ba2);
            --gradient-live-counter: linear-gradient(45deg, #28a745, #20c997);
        }

        /* Keep custom styles for components that require unique aesthetics not covered by Bootstrap */
        
        .file-drop-zone.dragover {
            border-color: var(--bs-primary) !important;
            background-color: rgba(var(--bs-primary-rgb), 0.1);
        }
        
        .url-textarea-drop.dragover {
            border-color: var(--bs-success) !important;
            background-color: rgba(var(--bs-success-rgb), 0.1);
        }
        
        /* Custom Badges with Gradients */
        .badge.feature-badge { background: var(--gradient-feature); }
        .badge.pro-badge { background: var(--gradient-pro); }
        .badge.ultimate-badge {
            background: var(--gradient-ultimate);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--bs-warning-rgb), 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 10px 5px rgba(var(--bs-warning-rgb), 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--bs-warning-rgb), 0); }
        }

        /* In-place editing styles */
        .editable-content[contenteditable="true"] {
            outline: 2px solid var(--bs-primary);
            background-color: var(--bs-warning-bg-subtle);
            padding: 0.25rem;
            border-radius: 0.25rem;
            cursor: text;
        }
        
        /* Gradient Sections */
        .sitemap-section { background: var(--gradient-sitemap); color: white; }
        .robots-section { background: var(--gradient-robots); color: #333; }
        .manifest-section { background: var(--gradient-manifest); color: #333; }
        .github-section { background: var(--gradient-github); color: #333; }
        .spa-section { background: var(--gradient-spa); color: #333; }
        .seo-crawler-section { background: var(--gradient-seo-crawler); color: #333; } /* New Style for SEO Crawler section */


        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }
        .drop-zone:hover {
            border-color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .robots-section .drop-zone, .manifest-section .drop-zone, .github-section .drop-zone, .spa-section .drop-zone, .seo-crawler-section .drop-zone {
            border-color: rgba(0, 0, 0, 0.3);
        }
        .robots-section .drop-zone:hover, .manifest-section .drop-zone:hover, .github-section .drop-zone:hover, .spa-section .drop-zone:hover, .seo-crawler-section .drop-zone:hover {
            border-color: #333;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode-toggle {
            background: var(--gradient-dark-toggle);
            transition: all 0.3s ease;
        }
        .dark-mode-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .live-counter {
            background: var(--gradient-live-counter);
            transition: all 0.3s ease;
        }

        .seo-summary-item { display: inline-block; margin-inline-end: 0.75rem; font-size: 0.8rem; }
        .seo-summary-item .badge { font-size: 0.75rem; }

        /* Custom Styles for new features */
        .cursor-pointer { cursor: pointer; }
        .accordion-button:not(.collapsed) { background-color: rgba(var(--bs-primary-rgb), 0.1); }
        /* NEW: RTL Accordion fix */
        [dir="rtl"] .accordion-button::after {
          margin-left: 0;
          margin-right: auto;
        }
        .seo-score-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            vertical-align: middle;
            border: 1px solid rgba(0,0,0,0.2);
        }
        .result-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        .result-item-url-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--bs-secondary-color);
        }

        /* NEW: Selection styling */
        .result-item.selected {
            background-color: rgba(var(--bs-primary-rgb), 0.08) !important;
            border-color: rgba(var(--bs-primary-rgb), 0.4) !important;
        }
    </style>
</head>
<body>
    <button id="darkModeToggle" class="dark-mode-toggle position-fixed top-0 start-0 m-3 z-3 rounded-pill py-2 px-3 border-0 text-white shadow-sm d-flex align-items-center gap-2">
        <!-- Icon is now controlled by JS -->
    </button>

    <div class="live-counter position-fixed d-none shadow-sm fw-bold text-white rounded-pill py-2 px-3 z-2 d-flex align-items-center gap-2" id="liveCounter" style="top: 80px; left: 20px;">
        <i class="bi bi-bar-chart-line-fill" aria-hidden="true"></i>
        <span>Ø§Ù„Ø¹Ù†Ø§ØµØ±: <span id="counterValue">0</span></span>
    </div>

    <div class="container mt-5 pt-4">
        <h1 class="text-center mb-4 display-6"><i class="bi bi-search" aria-hidden="true"></i> Ù…ÙˆÙ„Ø¯ ÙÙ‡Ø±Ø³ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªØ·ÙˆØ± <span class="badge ultimate-badge align-middle">Ultimate</span></h1>
        
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h3 class="h5 mb-0"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Ø¥Ø¯Ø®Ø§Ù„ ØµÙØ­Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
                    </div>
                    <div class="card-body">
                        <!-- NEW: SEO Crawler Section -->
                        <div class="seo-crawler-section rounded-3 p-3 my-3">
                            <h5 class="h6"><i class="bi bi-robot me-2" aria-hidden="true"></i>Ø²Ø§Ø­Ù SEO ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ <span class="badge ultimate-badge">Ø¬Ø¯ÙŠØ¯</span></h5>
                            <div class="input-group">
                                <input type="url" class="form-control" id="seoCrawlerUrl" placeholder="https://example.com">
                                <input type="number" class="form-control flex-grow-0" id="seoCrawlerDepth" value="1" min="0" max="5" style="width: 100px;" title="Ø¹Ù…Ù‚ Ø§Ù„Ø²Ø­Ù (0 = Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·)">
                                <button class="btn btn-dark" id="startCrawlerBtn">
                                    <i class="bi bi-rocket-takeoff-fill me-2" aria-hidden="true"></i>Ø²Ø­Ù ÙˆØªØ­Ù„ÙŠÙ„
                                </button>
                            </div>
                            <div class="mt-2">
                                <label for="customProxyUrl" class="form-label small opacity-75">Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù…Ø®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="url" class="form-control form-control-sm" id="customProxyUrl" placeholder="https://my-proxy.com/?url={url}">
                                <small class="d-block mt-1 opacity-75" style="font-size: .75rem;">Ø§Ø³ØªØ®Ø¯Ù… <code>{url}</code> ÙƒØ¹Ù†ØµØ± Ù†Ø§Ø¦Ø¨ Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… allorigins.win ÙƒØ®ÙŠØ§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ.</small>
                            </div>
                        </div>

                        <!-- SPA / Headless Analysis Section -->
                        <div class="spa-section rounded-3 p-3 my-3">
                            <h5 class="h6"><i class="bi bi-lightning-charge-fill me-2" aria-hidden="true"></i>ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ§Ù‚Ø¹ SPA (React/Vue) <span class="badge pro-badge">ØªØ¬Ø±ÙŠØ¨ÙŠ</span></h5>
                             <div class="input-group">
                                <input type="url" class="form-control" id="spaUrl" placeholder="https://my-react-app.com">
                                <button class="btn btn-dark" id="analyzeSpaBtn">
                                    <i class="bi bi-binoculars-fill me-2" aria-hidden="true"></i>ØªØ­Ù„ÙŠÙ„
                                </button>
                            </div>
                            <small class="d-block mt-2 opacity-75">
                                Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ø¹Ù„Ù‰ JS. Ù‚Ø¯ Ù„Ø§ ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
                            </small>
                        </div>

                        <!-- Robots.txt Section -->
                        <div class="robots-section rounded-3 p-3 my-3">
                            <h5 class="h6"><i class="bi bi-robot me-2" aria-hidden="true"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† robots.txt <span class="badge feature-badge">Ø¬Ø¯ÙŠØ¯</span></h5>
                            <div class="drop-zone rounded-3 p-3 text-center cursor-pointer" id="robotsDropZone">
                                <p class="mb-1">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„Ù robots.txt Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                                <small class="opacity-75">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø© ÙˆØ§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</small>
                                <input type="file" id="robotsFileInput" accept=".txt" class="d-none">
                            </div>
                        </div>

                        <!-- Manifest.json Section -->
                        <div class="manifest-section rounded-3 p-3 my-3">
                            <h5 class="h6"><i class="bi bi-pwa me-2" aria-hidden="true"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† manifest.json <span class="badge feature-badge">PWA</span></h5>
                            <div class="drop-zone rounded-3 p-3 text-center cursor-pointer" id="manifestDropZone">
                                <p class="mb-1">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„Ù manifest.json Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                                <small class="opacity-75">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ PWA</small>
                                <input type="file" id="manifestFileInput" accept=".json" class="d-none">
                            </div>
                        </div>

                        <!-- Sitemap.xml Section -->
                        <div class="sitemap-section rounded-3 p-3 my-3">
                            <h5 class="h6"><i class="bi bi-map-fill me-2" aria-hidden="true"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Sitemap.xml <span class="badge feature-badge">Ø°ÙƒÙŠ</span></h5>
                            <div class="drop-zone rounded-3 p-3 text-center cursor-pointer" id="sitemapDropZone">
                                <p class="mb-1">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„Ù sitemap.xml Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                                <small class="opacity-75">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</small>
                                <input type="file" id="sitemapFileInput" accept=".xml" class="d-none">
                            </div>
                        </div>

                        <!-- HTML File Analysis Section -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="bi bi-file-earmark-text-fill me-2" aria-hidden="true"></i>ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª HTML <span class="badge feature-badge">Ù…Ø­Ø³Ù†</span>
                            </label>
                            <div class="file-drop-zone border border-2 border-dashed rounded-3 p-4 text-center bg-body-secondary cursor-pointer" id="fileDropZone">
                                <p class="mb-1">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„ÙØ§Øª HTML Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                                <small class="text-muted">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ ÙˆØ¨ÙŠØ§Ù†Ø§Øª SEO ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</small>
                                <input type="file" id="htmlFileInput" multiple accept=".html,.htm" class="d-none">
                            </div>
                            <div class="d-none my-3" id="progressContainer">
                                <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</small>
                            </div>
                        </div>

                        <!-- Bulk Import Section -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="bi bi-folder2-open me-2" aria-hidden="true"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…Ø§Ø¹ÙŠ <span class="badge feature-badge">Ù…Ø­Ø³Ù†</span>
                            </label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="urlsFileInput" accept=".txt,.json">
                                <button class="btn btn-outline-primary" id="importUrlsFileBtn">
                                    <i class="bi bi-download me-2" aria-hidden="true"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                Ø±ÙˆØ§Ø¨Ø· ØµÙØ­Ø§Øª Ù…ÙˆÙ‚Ø¹Ùƒ <span class="badge pro-badge">Drag & Drop</span>
                            </label>
                            <div class="position-relative">
                                <textarea class="form-control url-textarea-drop" id="urlInput" rows="6" placeholder="index.html
about.html
services.html
...

ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙˆØµ Ù‡Ù†Ø§!" dir="ltr"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="manualInput">
                            <label class="form-check-label" for="manualInput">
                                Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ Ù„Ù„ØµÙØ­Ø§Øª
                            </label>
                        </div>
                        
                        <div id="manualInputSection" class="d-none border rounded p-3 mb-3">
                            <div class="d-grid gap-2">
                                <input type="text" class="form-control" id="pageTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©">
                                <input type="text" class="form-control" id="pageUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©">
                                <input type="text" class="form-control" id="pageDescription" placeholder="ÙˆØµÙ Ø§Ù„ØµÙØ­Ø©">
                                <input type="text" class="form-control" id="pageCategory" placeholder="ÙØ¦Ø© Ø§Ù„ØµÙØ­Ø©">
                                <input type="text" class="form-control" id="pageTags" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)">
                                <button class="btn btn-success btn-sm" id="addManualPageBtn">Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø©</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100" id="generateIndexBtn">
                            <i class="bi bi-rocket-takeoff-fill me-2" aria-hidden="true"></i>ØªÙˆÙ„ÙŠØ¯ ÙÙ‡Ø±Ø³ Ø§Ù„Ø¨Ø­Ø«
                        </button>
                        
                        <!-- NEW: Improved Data Management -->
                        <div class="mt-4 border-top pt-3">
                            <h6 class="h6"><i class="bi bi-folder-symlink-fill me-2" aria-hidden="true"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h6>
                            <div class="input-group mb-2">
                                <select class="form-select" id="projectSelector" title="Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ù‹Ø§ Ù…Ø­ÙÙˆØ¸Ù‹Ø§ Ù„ØªØ­Ù…ÙŠÙ„Ù‡">
                                    <option value="">-- Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ù‹Ø§ --</option>
                                </select>
                                <button class="btn btn-outline-danger" id="deleteProjectBtn" title="Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"><i class="bi bi-trash3-fill" aria-hidden="true"></i></button>
                            </div>
                            <div class="input-group">
                                <input type="text" class="form-control" id="projectNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                                <button class="btn btn-success" id="saveProjectBtn" title="Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ­Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…"><i class="bi bi-save-fill me-2" aria-hidden="true"></i>Ø­ÙØ¸</button>
                            </div>
                            <div class="d-flex justify-content-center mt-2">
                                <button class="btn btn-link text-decoration-none btn-sm" id="clearFormBtn"><i class="bi bi-sparkles me-1" aria-hidden="true"></i>Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ (Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„)</button>
                            </div>
                            <small class="text-muted d-block mt-1 text-center">ØªØªÙ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h3 class="h5 mb-0"><i class="bi bi-bar-chart-steps me-2" aria-hidden="true"></i>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ <span class="badge pro-badge">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ø±ÙŠØ±</span></h3>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <!-- Statistics Panel -->
                        <div id="statsPanel" class="d-none rounded-3 p-3 my-3 text-white" style="background: var(--gradient-sitemap);">
                            <h6 class="h6"><i class="bi bi-graph-up-arrow me-2" aria-hidden="true"></i>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¯Ø§Ø®Ù„ÙŠØ©</h6>
                            <div class="d-flex justify-content-between align-items-center py-1 border-bottom border-white border-opacity-25"><span>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª:</span><strong id="statPages">0</strong></div>
                            <div class="d-flex justify-content-between align-items-center py-1 border-bottom border-white border-opacity-25"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©:</span><strong id="statKeywords">0</strong></div>
                            <div class="d-flex justify-content-between align-items-center py-1 border-bottom border-white border-opacity-25"><span>Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©:</span><strong id="statCategories">0</strong></div>
                            <div class="d-flex justify-content-between align-items-center py-1"><span>Ø£ÙƒØ«Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØªÙƒØ±Ø§Ø±Ø§Ù‹:</span><strong id="statTopKeyword">-</strong></div>
                        </div>

                        <!-- Filter Section -->
                        <div id="filterSection" class="d-none bg-body-secondary border rounded-3 p-3 my-3">
                            <h6 class="h6 mb-2"><i class="bi bi-funnel-fill me-2" aria-hidden="true"></i>ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h6>
                            <div class="input-group">
                                <select class="form-select" id="categoryFilter"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option></select>
                                <input type="text" class="form-control" id="keywordFilter" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©">
                            </div>
                        </div>
                        
                        <!-- NEW: Selection Controls -->
                        <div id="selectionControls" class="d-none d-flex justify-content-between align-items-center bg-body-tertiary p-2 rounded-top-2 border-bottom">
                            <div>
                                <button class="btn btn-outline-primary btn-sm" id="selectAllBtn"><i class="bi bi-check-all me-2" aria-hidden="true"></i>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                                <button class="btn btn-outline-secondary btn-sm" id="deselectAllBtn"><i class="bi bi-x-lg me-2" aria-hidden="true"></i>Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                            </div>
                            <span class="text-muted small">ØªÙ… ØªØ­Ø¯ÙŠØ¯: <strong id="selectionCounter">0</strong></span>
                        </div>

                        <div id="results" class="p-1 bg-body-secondary rounded-bottom-2 overflow-y-auto flex-grow-1" style="min-height: 200px; max-height: 500px;">
                            <p class="text-muted text-center m-0 p-3">Ø£Ø¯Ø®Ù„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø§Øª Ø£Ùˆ Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ ÙÙ‡Ø±Ø³ Ø§Ù„Ø¨Ø­Ø«"</p>
                        </div>
                        
                        <!-- Enhanced Export Options -->
                        <div id="exportButtons" class="d-none d-flex gap-2 flex-wrap mt-3">
                            <button class="btn btn-success flex-grow-1" id="downloadJsonBtn"><i class="bi bi-filetype-json me-2" aria-hidden="true"></i>JSON</button>
                            <button class="btn btn-info flex-grow-1" id="downloadCsvBtn"><i class="bi bi-filetype-csv me-2" aria-hidden="true"></i>CSV</button>
                            <button class="btn btn-warning flex-grow-1" id="downloadZipBtn"><i class="bi bi-file-zip-fill me-2" aria-hidden="true"></i>ZIP</button>
                            <button class="btn btn-secondary flex-grow-1" id="toggleCopyBtn"><i class="bi bi-clipboard-fill me-2" aria-hidden="true"></i>Ù†Ø³Ø®</button>
                        </div>

                        <!-- ZIP Progress -->
                        <div id="zipProgress" class="d-none mt-2">
                            <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" id="zipProgressBar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted" id="zipProgressText">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ZIP...</small>
                        </div>

                        <!-- Copy Options -->
                        <div id="copyOptions" class="d-none mt-2 p-3 bg-body-secondary border rounded-3">
                            <h6 class="h6">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø³Ø®:</h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary btn-sm" data-copy-type="all"><i class="bi bi-clipboard-check-fill me-2" aria-hidden="true"></i>Ù†Ø³Ø® ÙƒØ§Ù…Ù„ (JSON)</button>
                                <button class="btn btn-outline-secondary btn-sm" data-copy-type="titles"><i class="bi bi-fonts me-2" aria-hidden="true"></i>Ù†Ø³Ø® Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙ‚Ø·</button>
                                <button class="btn btn-outline-info btn-sm" data-copy-type="urls"><i class="bi bi-link-45deg me-2" aria-hidden="true"></i>Ù†Ø³Ø® Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙ‚Ø·</button>
                                <button class="btn btn-outline-success btn-sm" data-copy-type="descriptions"><i class="bi bi-card-text me-2" aria-hidden="true"></i>Ù†Ø³Ø® Ø§Ù„Ø£ÙˆØµØ§Ù ÙÙ‚Ø·</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-5">
            <div class="col-12">
                <div class="alert alert-info">
                    <h4 class="alert-heading"><i class="bi bi-book-half me-2" aria-hidden="true"></i>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h4>
                    <ol class="mb-0">
                        <li><strong>Ø¬Ø¯ÙŠØ¯ ÙˆÙ…Ø­Ø³Ù‘Ù†:</strong> Ø§Ø³ØªØ®Ø¯Ù… "Ø²Ø§Ø­Ù SEO" Ù„ØªØ­Ù„ÙŠÙ„ Ù…ÙˆÙ‚Ø¹Ùƒ. ØªØ§Ø¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù… Ø¹Ø¨Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.</li>
                        <li>Ø§Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ SPAØŒ Ù…Ù„ÙØ§Øª `robots.txt`ØŒ `manifest.json`ØŒ `sitemap.xml`ØŒ Ø£Ùˆ Ù…Ù„ÙØ§Øª HTML.</li>
                        <li>Ø£Ø¶Ù Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ©.</li>
                        <li>Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ ÙÙ‡Ø±Ø³ Ø§Ù„Ø¨Ø­Ø«" Ù„Ø¯Ù…Ø¬ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª.</li>
                        <li><strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹:</strong>
                            <ul>
                                <li>Ù„Ø­ÙØ¸ Ø¹Ù…Ù„ÙƒØŒ Ø£Ø¯Ø®Ù„ "Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" ÙˆØ§Ø¶ØºØ· "ğŸ’¾ Ø­ÙØ¸".</li>
                                <li>Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹ Ø³Ø§Ø¨Ù‚ØŒ Ø§Ø®ØªØ±Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©.</li>
                                <li>Ù„Ø­Ø°Ù Ù…Ø´Ø±ÙˆØ¹ØŒ Ø§Ø®ØªØ±Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ø¶ØºØ· "ğŸ—‘ï¸ Ø­Ø°Ù".</li>
                                <li>Ù„Ø¨Ø¯Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ø§Ø¶ØºØ· "âœ¨ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯".</li>
                            </ul>
                        </li>
                        <li>Ø­Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ Ø«Ù… Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ±Ù‡Ø§ (JSON, CSV, ZIP) Ø£Ùˆ Ù†Ø³Ø®Ù‡Ø§.</li>
                        <li>Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ø±ÙŠØ±".</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Crawler Status Indicator -->
    <div id="crawlerStatus" class="d-none position-fixed bottom-0 end-0 m-3 p-3 shadow-lg rounded-3 bg-body-tertiary" style="z-index: 1100; width: 350px;">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0 fw-bold"><i class="bi bi-robot me-2" aria-hidden="true"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø²Ø­Ù...</h6>
            <button type="button" class="btn-close" id="hideCrawlerStatusBtn" aria-label="Close"></button>
        </div>
        <p class="text-muted small mb-1 text-truncate" id="crawlerCurrentUrl">Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©...</p>
        <div class="progress" role="progressbar" style="height: 10px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" id="crawlerProgressBar" style="width: 0%;"></div>
        </div>
        <div class="d-flex justify-content-between small mt-1 text-muted">
            <span id="crawlerProgressText">0/0</span>
            <span id="crawlerQueueCount">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: 0</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

    <script>
    (function() { // Start of IIFE to encapsulate code
        // --- Centralized Application State ---
        const appState = {
            searchIndex: [],
            manualPages: [],
            analyzedFiles: [],
            sitemapUrls: [],
            robotsUrls: [],
            manifestData: {},
            filteredResults: [],
            selectedItemIds: new Set(),
        };

        const PROJECTS_MASTER_KEY = 'searchIndexGenerator_projects';
        const LAST_PROJECT_KEY = 'searchIndexGenerator_lastProject';

        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let isDarkMode = localStorage.getItem('darkMode') === 'true' || (localStorage.getItem('darkMode') === null && prefersDark);
        
        const getEl = (id) => document.getElementById(id);

        function setDarkMode(isDark) {
            isDarkMode = isDark;
            localStorage.setItem('darkMode', isDarkMode);
            document.documentElement.setAttribute('data-bs-theme', isDark ? 'dark' : 'light');
            updateDarkModeButton();
        }

        function toggleDarkMode() {
            setDarkMode(!isDarkMode);
            const icon = isDarkMode ? `<i class="bi bi-moon-stars-fill me-2" aria-hidden="true"></i>` : `<i class="bi bi-sun-fill me-2" aria-hidden="true"></i>`;
            showNotification(`${icon} ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ${isDarkMode ? 'Ø§Ù„Ù„ÙŠÙ„ÙŠ' : 'Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ'}`, 'info');
        }
        
        function updateDarkModeButton() {
            const button = getEl('darkModeToggle');
            if (isDarkMode) {
                button.innerHTML = `<i class="bi bi-sun-fill" aria-hidden="true"></i> <span class="d-none d-sm-inline">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ</span>`;
            } else {
                button.innerHTML = `<i class="bi bi-moon-stars-fill" aria-hidden="true"></i> <span class="d-none d-sm-inline">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</span>`;
            }
        }

        function getProxyUrl(targetUrl) {
            const customProxy = getEl('customProxyUrl').value.trim();
            if (customProxy) {
                return customProxy.replace('{url}', encodeURIComponent(targetUrl));
            }
            return `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;
        }
        
        async function startSeoCrawler() {
            const baseUrlInput = getEl('seoCrawlerUrl');
            let baseUrl = baseUrlInput.value.trim();
            if (!baseUrl) { return showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø²Ø­Ù', 'warning'); }
            
            try {
                if (!/^https?:\/\//i.test(baseUrl)) { baseUrl = 'https://' + baseUrl; baseUrlInput.value = baseUrl; }
                new URL(baseUrl);
            } catch (e) { return showNotification('Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± ØµØ§Ù„Ø­', 'danger'); }

            const maxDepth = parseInt(getEl('seoCrawlerDepth').value, 10) || 0;
            const origin = new URL(baseUrl).origin;
            showNotification(`<i class="bi bi-rocket-takeoff-fill me-2" aria-hidden="true"></i> Ø¨Ø¯Ø¡ Ø²Ø­Ù SEO Ù„Ù€ ${origin}...`, 'info');

            // NEW: Crawler Status UI
            const crawlerStatus = getEl('crawlerStatus');
            const crawlerCurrentUrl = getEl('crawlerCurrentUrl');
            const crawlerProgressBar = getEl('crawlerProgressBar');
            const crawlerProgressText = getEl('crawlerProgressText');
            const crawlerQueueCount = getEl('crawlerQueueCount');
            crawlerStatus.classList.remove('d-none');

            let queue = [{ url: baseUrl, depth: 0 }];
            const visited = new Set([baseUrl]);
            const crawledData = new Map();
            const brokenLinks = new Set();
            let processedCount = 0;
            
            const updateCrawlerUI = () => {
                const totalToProcess = processedCount + queue.length;
                const percentage = totalToProcess > 0 ? (processedCount / totalToProcess) * 100 : 0;
                crawlerProgressBar.style.width = `${percentage}%`;
                crawlerProgressText.textContent = `${processedCount}/${totalToProcess}`;
                crawlerQueueCount.textContent = `ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${queue.length}`;
            };
            
            updateCrawlerUI();

            while (queue.length > 0) {
                await new Promise(r => setTimeout(r, 200));

                const { url, depth } = queue.shift();
                processedCount++;
                crawlerCurrentUrl.textContent = `ÙØ­Øµ: ${new URL(url).pathname}...`;
                updateCrawlerUI();
                
                try {
                    const startTime = performance.now();
                    const response = await fetch(getProxyUrl(url));
                    const loadTime = Math.round(performance.now() - startTime);

                    if (!response.ok) throw new Error(`Status ${response.status}`);
                    const html = await response.text();
                    const doc = new DOMParser().parseFromString(html, 'text/html');

                    const analysis = analyzeHtmlContent(html, url, { loadTime });
                    const linksOnPage = new Set();
                    doc.querySelectorAll('a[href]').forEach(link => {
                        const href = link.getAttribute('href');
                        if (!href || href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
                        try {
                            const absoluteUrl = new URL(href, url).href;
                            linksOnPage.add(absoluteUrl);
                            if (absoluteUrl.startsWith(origin) && !visited.has(absoluteUrl) && depth < maxDepth) {
                                const fileExtension = absoluteUrl.split('.').pop().toLowerCase();
                                const isPage = !['jpg', 'jpeg', 'png', 'gif', 'svg', 'css', 'js', 'pdf', 'zip'].includes(fileExtension);
                                if(isPage) { visited.add(absoluteUrl); queue.push({ url: absoluteUrl, depth: depth + 1 }); }
                            }
                        } catch (e) { /* Ignore invalid URLs */ }
                    });
                    crawledData.set(url, { analysis, outgoingLinks: [...linksOnPage] });
                } catch (error) {
                    console.error(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ${url}:`, error);
                    brokenLinks.add(url);
                    showNotification(`<i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i> Ø±Ø§Ø¨Ø· Ù…ÙƒØ³ÙˆØ± Ø£Ùˆ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${new URL(url).pathname}`, 'warning');
                }
                updateCrawlerUI();
            }

            crawlerCurrentUrl.textContent = 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø²Ø­Ù! Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬...';
            crawlerProgressBar.style.width = '100%';

            crawledData.forEach((data, pageUrl) => { data.analysis.seo.brokenLinksOnPage = data.outgoingLinks.filter(link => brokenLinks.has(link)); });
            
            const newItems = Array.from(crawledData.values()).map(({ analysis }) => ({
                title: analysis.title, description: analysis.description, url: analysis.url,
                category: 'Ø²Ø§Ø­Ù SEO',
                tags: analysis.keywords.length > 0 ? analysis.keywords : extractTagsFromUrl(analysis.url),
                source: 'seo_crawler', seo: analysis.seo
            }));
            
            const addedCount = addItemsToIndex(newItems);
            
            if (addedCount > 0) {
                showNotification(`<i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i> Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø²Ø­Ù! ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${addedCount} ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©.`, 'success');
                updateAllUI();
                saveProject(); // Auto-save after successful crawl
            } else if (crawledData.size > 0) {
                showNotification('ğŸ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø²Ø­Ù. Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„.', 'info');
            } else {
                showNotification('âŒ ÙØ´Ù„ Ø§Ù„Ø²Ø­Ù. Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ ØµÙØ­Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙˆØµÙˆÙ„.', 'danger');
            }
            if (brokenLinks.size > 0) { showNotification(`<i class="bi bi-exclamation-octagon-fill me-2" aria-hidden="true"></i> ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${brokenLinks.size} Ø±Ø§Ø¨Ø· Ø¯Ø§Ø®Ù„ÙŠ Ù…ÙƒØ³ÙˆØ±.`, 'danger', 7000); }
            setTimeout(() => { crawlerStatus.classList.add('d-none'); }, 5000);
        }

        function analyzeHtmlContent(content, urlOrFilename, options = {}) {
            const doc = new DOMParser().parseFromString(content, 'text/html');
            const isUrl = urlOrFilename.startsWith('http');
            const url = isUrl ? new URL(urlOrFilename) : null;
            const filename = isUrl ? url.pathname.split('/').pop() || 'index.html' : urlOrFilename;
            
            let title = doc.querySelector('title')?.textContent.trim() || filename.replace(/\.(html?|htm)$/i, '').replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            let description = doc.querySelector('meta[name="description"]')?.getAttribute('content') || doc.querySelector('meta[property="og:description"]')?.getAttribute('content') || doc.querySelector('article p, main p')?.textContent.trim().substring(0, 200) + '...' || `ØµÙØ­Ø© ${title}`;
            let keywords = doc.querySelector('meta[name="keywords"]')?.getAttribute('content')?.split(',').map(k => k.trim()).filter(Boolean) || [];
            
            const images = doc.querySelectorAll('img');
            const imagesWithoutAlt = [...images].filter(img => !img.getAttribute('alt')?.trim());
            const robotsMeta = doc.querySelector('meta[name="robots"]');
            const isNoIndex = robotsMeta ? /noindex/i.test(robotsMeta.getAttribute('content')) : false;

            const seoData = {
                h1: doc.querySelector('h1')?.textContent.trim() || null,
                lang: doc.documentElement.getAttribute('lang') || null,
                canonical: doc.querySelector('link[rel="canonical"]')?.getAttribute('href') || null,
                imageAltInfo: { total: images.length, missing: imagesWithoutAlt.length },
                brokenLinksOnPage: [],
                loadTime: options.loadTime || null,
                isNoIndex: isNoIndex
            };
            
            return { filename, title, description, keywords, url: isUrl ? url.pathname : '/' + filename, source: isUrl ? 'seo_crawler' : 'html_analysis', content, seo: seoData };
        }
        
        function handleGenerateClick() {
            const newItems = generateSearchIndex();
            
            if (newItems.length === 0 && appState.searchIndex.length === 0) {
                return showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            }
            const addedCount = addItemsToIndex(newItems);
            
            if (addedCount > 0) {
                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${addedCount} Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯! Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${appState.searchIndex.length}`, 'success');
            } else {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ø¯Ù‘Ø«Ø©.', 'info');
            }
            updateAllUI();
            saveProject();
        }
        
        // NEW Helper to add items and avoid duplicates
        function addItemsToIndex(itemsToAdd) {
            const existingUrls = new Set(appState.searchIndex.map(item => item.url.endsWith('/') && item.url.length > 1 ? item.url.slice(0, -1) : item.url));
            let idCounter = appState.searchIndex.length > 0 ? Math.max(...appState.searchIndex.map(item => item.id)) + 1 : 1;
            let addedCount = 0;

            itemsToAdd.forEach(item => {
                const urlKey = item.url.endsWith('/') && item.url.length > 1 ? item.url.slice(0, -1) : item.url;
                if (!existingUrls.has(urlKey)) {
                    item.id = idCounter++;
                    appState.searchIndex.push(item);
                    existingUrls.add(urlKey);
                    addedCount++;
                }
            });
            return addedCount;
        }

        function generateSearchIndex() {
            const newItems = [];
            const existingUrls = new Set(appState.searchIndex.map(item => item.url.endsWith('/') && item.url.length > 1 ? item.url.slice(0, -1) : item.url));
            const addItem = (item) => {
                const urlKey = item.url.endsWith('/') && item.url.length > 1 ? item.url.slice(0, -1) : item.url;
                if (!existingUrls.has(urlKey)) newItems.push(item);
            };
            
            appState.analyzedFiles.forEach(file => addItem({
                title: file.title, description: file.description, url: file.url,
                category: file.category || (file.source === 'seo_crawler' ? 'Ø²Ø§Ø­Ù SEO' : 'ØªØ­Ù„ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ'),
                tags: file.keywords && file.keywords.length > 0 ? file.keywords : extractTagsFromUrl(file.url),
                source: file.source || 'html_analysis', seo: file.seo
            }));
            
            if (getEl('manualInput').checked) { appState.manualPages.forEach(page => addItem({ ...page, source: 'manual' })); }
            
            getEl('urlInput').value.trim().split('\n').filter(Boolean).forEach(urlStr => {
                const url = urlStr.trim().startsWith('/') ? urlStr.trim() : '/' + urlStr.trim();
                if (existingUrls.has(url)) return;

                const fileName = url.split('/').pop().replace(/\.html?$/, '');
                const pathParts = url.split('/').filter(Boolean);
                const category = pathParts.length > 1 ? pathParts[0] : 'Ø¹Ø§Ù…';
                const titleMap = { 'index': 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'about': 'Ù…Ù† Ù†Ø­Ù†', 'contact': 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', 'services': 'Ø®Ø¯Ù…Ø§ØªÙ†Ø§', 'blog': 'Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©' };
                let title = titleMap[fileName.toLowerCase()] || (fileName.charAt(0).toUpperCase() + fileName.slice(1).replace(/[-_]/g, ' '));
                let source = appState.sitemapUrls.includes(url) ? 'sitemap' : appState.robotsUrls.includes(url) ? 'robots' : 'url_generation';
                
                addItem({ title, description: `ØµÙØ­Ø© ${title}`, url, category: category.charAt(0).toUpperCase() + category.slice(1), tags: extractTagsFromUrl(url), source });
            });
            return newItems;
        }

        function calculateSeoScore(seo) {
            if (!seo) return { score: 0, maxScore: 6, color: '#6c757d', level: 'ØºÙŠØ± Ù…ØªÙˆÙØ±' };
            let score = 0;
            const maxScore = 6;
            if (seo.h1) score++;
            if (seo.canonical) score++;
            if (seo.imageAltInfo && seo.imageAltInfo.total > 0 && seo.imageAltInfo.missing === 0) score++;
            if (seo.brokenLinksOnPage && seo.brokenLinksOnPage.length === 0) score++;
            if (!seo.isNoIndex) score++;
            if (seo.lang) score++;
            
            const percentage = (score / maxScore) * 100;
            if (percentage >= 80) return { score, maxScore, color: '#198754', level: 'Ù…Ù…ØªØ§Ø²' };
            if (percentage >= 50) return { score, maxScore, color: '#ffc107', level: 'Ø¬ÙŠØ¯' };
            return { score, maxScore, color: '#dc3545', level: 'ÙŠØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' };
        }

        function renderSeoSummary(seo, itemId) {
            if (!seo) return '';
            const h1 = seo.h1 ? `<span class="badge bg-success">Ù…ÙˆØ¬ÙˆØ¯</span>` : `<span class="badge bg-danger">Ù…ÙÙ‚ÙˆØ¯</span>`;
            const canonical = seo.canonical ? `<span class="badge bg-success">Ù…ÙˆØ¬ÙˆØ¯</span>` : `<span class="badge bg-danger">Ù…ÙÙ‚ÙˆØ¯</span>`;
            const lang = seo.lang ? `<span class="badge bg-success">${seo.lang}</span>` : `<span class="badge bg-danger">Ù…ÙÙ‚ÙˆØ¯</span>`;
            
            let imgAltBadge;
            if (!seo.imageAltInfo || seo.imageAltInfo.total === 0) {
                imgAltBadge = `<span class="badge bg-secondary">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>`;
            } else if (seo.imageAltInfo.missing === 0) {
                imgAltBadge = `<span class="badge bg-success">${seo.imageAltInfo.total}/${seo.imageAltInfo.total}</span>`;
            } else {
                imgAltBadge = `<span class="badge bg-warning">${seo.imageAltInfo.total - seo.imageAltInfo.missing}/${seo.imageAltInfo.total}</span>`;
            }

            const brokenLinksCount = seo.brokenLinksOnPage?.length || 0;
            let brokenLinksHtml;
            if (brokenLinksCount > 0) {
                const collapseId = `brokenLinks-${itemId}`;
                brokenLinksHtml = `
                    <span class="badge bg-danger cursor-pointer" data-bs-toggle="collapse" href="#${collapseId}" role="button">${brokenLinksCount}</span>
                    <div class="collapse mt-2" id="${collapseId}">
                        <ul class="list-group list-group-flush small">
                            ${seo.brokenLinksOnPage.map(link => `<li class="list-group-item list-group-item-danger py-1 px-2 text-break">${link}</li>`).join('')}
                        </ul>
                    </div>`;
            } else {
                brokenLinksHtml = `<span class="badge bg-success">0</span>`;
            }

            return `<div class="mt-2 pt-2 border-top border-opacity-10">
                <div class="seo-summary-item"><strong>H1:</strong> ${h1}</div>
                <div class="seo-summary-item"><strong>Lang:</strong> ${lang}</div>
                <div class="seo-summary-item"><strong>Canonical:</strong> ${canonical}</div>
                <div class="seo-summary-item"><strong>Img Alt:</strong> ${imgAltBadge}</div>
                <div class="seo-summary-item"><strong>Ø±ÙˆØ§Ø¨Ø· Ù…ÙƒØ³ÙˆØ±Ø©:</strong> ${brokenLinksHtml}</div>
            </div>`;
        };
        
        function displayResults(resultsToShow = null) {
            const resultsDiv = getEl('results');
            const results = resultsToShow || appState.searchIndex;

            getEl('selectionControls').classList.toggle('d-none', results.length === 0);
            getEl('exportButtons').classList.toggle('d-none', results.length === 0);

            if (results.length === 0) {
                resultsDiv.innerHTML = '<p class="text-danger text-center m-0 p-3">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ùˆ Ù„Ù„Ø¹Ø±Ø¶</p>';
                return;
            }
            const grouped = results.reduce((acc, item) => {
                (acc[item.source || 'unknown'] = acc[item.source || 'unknown'] || []).push(item);
                return acc;
            }, {});

            const sourceLabels = {
                'seo_crawler': `<i class="bi bi-robot me-2" aria-hidden="true"></i>Ø²Ø§Ø­Ù SEO`,
                'html_analysis': `<i class="bi bi-file-earmark-code-fill me-2" aria-hidden="true"></i>ØªØ­Ù„ÙŠÙ„ HTML`,
                'manual': `<i class="bi bi-pencil-fill me-2" aria-hidden="true"></i>Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ`,
                'url_generation': `<i class="bi bi-link-45deg me-2" aria-hidden="true"></i>Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·`,
                'sitemap': `<i class="bi bi-map-fill me-2" aria-hidden="true"></i>Ù…Ù† Sitemap`,
                'robots': `<i class="bi bi-robot me-2" aria-hidden="true"></i>Ù…Ù† robots.txt`,
                'spa_analysis': `<i class="bi bi-lightning-charge-fill me-2" aria-hidden="true"></i>ØªØ­Ù„ÙŠÙ„ SPA`
            };

            resultsDiv.innerHTML = `<h5 class="p-3 pb-0 d-none">ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${results.length} Ø¹Ù†ØµØ±:</h5>
            <div class="accordion accordion-flush" id="resultsAccordion">
            ${Object.entries(grouped).map(([source, items], index) => {
                const collapseId = `collapse-source-${source.replace(/[^a-zA-Z0-9]/g, '-')}-${index}`;
                const isFirst = index === 0;
                return `
                <div class="accordion-item bg-transparent">
                    <h2 class="accordion-header" id="heading-${collapseId}">
                        <button class="accordion-button ${isFirst ? '' : 'collapsed'}" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}">
                            ${sourceLabels[source] || source} (${items.length})
                        </button>
                    </h2>
                    <div id="${collapseId}" class="accordion-collapse collapse ${isFirst ? 'show' : ''}" data-bs-parent="#resultsAccordion">
                        <div class="accordion-body">
                            ${items.map(item => {
                                const seoScore = calculateSeoScore(item.seo);
                                const isSelected = appState.selectedItemIds.has(item.id);
                                return `
                                <div class="result-item bg-body border rounded-2 p-3 my-2 ${isSelected ? 'selected' : ''}" data-id="${item.id}">
                                    <div class="result-item-header">
                                        <div class="flex-grow-1 d-flex align-items-center">
                                            <input type="checkbox" class="form-check-input me-3 flex-shrink-0 item-select-checkbox" aria-label="Select item" ${isSelected ? 'checked' : ''}>
                                            <span class="seo-score-dot me-2" style="background-color: ${seoScore.color};" title="ØªÙ‚ÙŠÙŠÙ… SEO: ${seoScore.level} (${seoScore.score}/${seoScore.maxScore})"></span>
                                            <span class="page-title editable-content text-primary fw-bold" data-field="title">${item.title}</span>
                                            ${item.seo?.isNoIndex ? '<span class="badge bg-danger ms-2" title="Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø³ØªØ¨Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„ÙÙ‡Ø±Ø³Ø© (noindex)">Ù„Ø§ Ù„Ù„ÙÙ‡Ø±Ø³Ø©</span>' : ''}
                                        </div>
                                        <button class="btn btn-outline-secondary btn-sm btn-edit">ØªØ­Ø±ÙŠØ±</button>
                                    </div>
                                    <div class="result-item-url-bar">
                                        <span class="text-break">${item.url}</span>
                                        ${item.seo?.loadTime ? `<span>${item.seo.loadTime}ms</span>` : ''}
                                    </div>
                                    <div class="text-muted editable-content mt-1" data-field="description">${item.description}</div>
                                    <div class="mt-2 small"><span class="text-info">Ø§Ù„ÙØ¦Ø©:</span> <span class="editable-content" data-field="category">${item.category || ''}</span></div>
                                    <div class="mt-1 small"><span class="text-success">Ø§Ù„ÙƒÙ„Ù…Ø§Øª:</span> <span class="editable-content" data-field="tags">${(item.tags || []).join(', ')}</span></div>
                                    ${renderSeoSummary(item.seo, item.id)}
                                </div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>`;
            }).join('')}
            </div>`;
            updateSelectionCounter();
        }
        
        function updateAllUI() {
            displayResults(appState.filteredResults.length > 0 ? appState.filteredResults : appState.searchIndex);
            updateStatistics();
            updateLiveCounter();
            updateFilterOptions();
            getEl('filterSection').classList.toggle('d-none', appState.searchIndex.length === 0);
            getEl('selectionControls').classList.toggle('d-none', appState.searchIndex.length === 0);
        }

        function updateLiveCounter() {
            const counter = getEl('liveCounter');
            if (appState.searchIndex.length > 0) {
                counter.classList.remove('d-none');
                getEl('counterValue').textContent = appState.searchIndex.length;
            } else {
                counter.classList.add('d-none');
            }
        }

        function updateStatistics() {
            const statsPanel = getEl('statsPanel');
            if (appState.searchIndex.length === 0) {
                statsPanel.classList.add('d-none');
                return;
            }
            statsPanel.classList.remove('d-none');
            const allKeywords = appState.searchIndex.flatMap(item => item.tags || []);
            const uniqueCategories = [...new Set(appState.searchIndex.map(item => item.category).filter(Boolean))];
            const keywordCount = allKeywords.reduce((acc, keyword) => {
                acc[keyword] = (acc[keyword] || 0) + 1;
                return acc;
            }, {});
            const topKeyword = Object.keys(keywordCount).reduce((a, b) => keywordCount[a] > keywordCount[b] ? a : b, '-');
            getEl('statPages').textContent = appState.searchIndex.length;
            getEl('statKeywords').textContent = allKeywords.length;
            getEl('statCategories').textContent = uniqueCategories.length;
            getEl('statTopKeyword').textContent = topKeyword === '-' ? '-' : `${topKeyword} (${keywordCount[topKeyword]})`;
        }
        
        function setupFilters() { getEl('categoryFilter').addEventListener('change', applyFilters); getEl('keywordFilter').addEventListener('input', applyFilters); }
        
        function updateFilterOptions() {
            const categoryFilter = getEl('categoryFilter');
            const currentCategory = categoryFilter.value;
            const categories = [...new Set(appState.searchIndex.map(item => item.category).filter(Boolean))].sort();
            categoryFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>';
            categories.forEach(category => {
                const option = document.createElement('option'); option.value = category; option.textContent = category;
                if (category === currentCategory) {
                    option.selected = true;
                }
                categoryFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const categoryFilterValue = getEl('categoryFilter').value;
            const keywordFilterValue = getEl('keywordFilter').value.toLowerCase();
            appState.filteredResults = appState.searchIndex.filter(item => {
                const matchesCategory = !categoryFilterValue || item.category === categoryFilterValue;
                const matchesKeyword = !keywordFilterValue || item.title.toLowerCase().includes(keywordFilterValue) || item.description.toLowerCase().includes(keywordFilterValue) || (item.tags && item.tags.some(tag => tag.toLowerCase().includes(keywordFilterValue)));
                return matchesCategory && matchesKeyword;
            });
            displayResults(appState.filteredResults);
        }

        function updateSelectionCounter() {
            getEl('selectionCounter').textContent = appState.selectedItemIds.size;
        }

        function toggleItemSelection(checkbox, itemId) {
            const itemDiv = document.querySelector(`.result-item[data-id="${itemId}"]`);
            if (checkbox.checked) {
                appState.selectedItemIds.add(itemId);
                itemDiv?.classList.add('selected');
            } else {
                appState.selectedItemIds.delete(itemId);
                itemDiv?.classList.remove('selected');
            }
            updateSelectionCounter();
        }

        function selectAllItems() {
            const currentlyVisibleItems = document.querySelectorAll('#results .result-item');
            currentlyVisibleItems.forEach(itemDiv => {
                const itemId = parseInt(itemDiv.dataset.id, 10);
                const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                if (checkbox && !checkbox.checked) {
                    checkbox.checked = true;
                    appState.selectedItemIds.add(itemId);
                    itemDiv.classList.add('selected');
                }
            });
            updateSelectionCounter();
        }

        function deselectAllItems() {
            document.querySelectorAll('#results .result-item').forEach(itemDiv => {
                const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                if (checkbox && checkbox.checked) checkbox.checked = false;
                itemDiv.classList.remove('selected');
            });
            appState.selectedItemIds.clear();
            updateSelectionCounter();
        }
        
        function getSelectedItems() {
            if (appState.selectedItemIds.size === 0) {
                return appState.filteredResults.length > 0 ? appState.filteredResults : appState.searchIndex;
            }
            return appState.searchIndex.filter(item => appState.selectedItemIds.has(item.id));
        }

        const getStrippedIndex = (items) => items.map(({ id, title, description, url, category, tags, seo }) => ({ id, title, description, url, category, tags, seo }));

        function downloadJson() {
            const itemsToDownload = getSelectedItems();
            if (itemsToDownload.length === 0) return showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
            const data = getStrippedIndex(itemsToDownload);
            downloadFile(new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' }), 'search-index.json');
            showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${itemsToDownload.length} Ø¹Ù†ØµØ± ÙƒÙ€ JSON <i class="bi bi-filetype-json ms-2" aria-hidden="true"></i>`, 'success');
        }

        function downloadCSV() {
            const itemsToDownload = getSelectedItems();
            if (itemsToDownload.length === 0) return showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
            const csv = ['ID,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†,Ø§Ù„Ø±Ø§Ø¨Ø·,Ø§Ù„ÙˆØµÙ,Ø§Ù„ÙØ¦Ø©,Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©', ...itemsToDownload.map(i => [`"${i.id}"`, `"${i.title.replace(/"/g, '""')}"`, `"${i.url}"`, `"${i.description.replace(/"/g, '""')}"`, `"${i.category || ''}"`, `"${(i.tags || []).join(', ')}"`].join(','))].join('\n');
            downloadFile(new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' }), 'search-index.csv');
            showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${itemsToDownload.length} Ø¹Ù†ØµØ± ÙƒÙ€ CSV <i class="bi bi-filetype-csv ms-2" aria-hidden="true"></i>`, 'success');
        }

        async function downloadZip() {
            const itemsToDownload = getSelectedItems();
            if (itemsToDownload.length === 0) return showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');

            const zipProgress = getEl('zipProgress'); const zipProgressBar = getEl('zipProgressBar'); zipProgress.classList.remove('d-none');
            try {
                const zip = new JSZip();
                zip.file('search-index.json', JSON.stringify(getStrippedIndex(itemsToDownload), null, 2));
                
                const selectedUrls = new Set(itemsToDownload.map(item => item.url));
                const htmlFiles = appState.analyzedFiles.filter(f => f.content && selectedUrls.has(f.url));
                
                if (htmlFiles.length > 0) { const htmlFolder = zip.folder('html-files'); htmlFiles.forEach(f => htmlFolder.file(f.filename, f.content)); }
                
                const content = await zip.generateAsync({ type: 'blob' }, (metadata) => { zipProgressBar.style.width = metadata.percent.toFixed(2) + '%'; });
                downloadFile(content, 'search-index-package.zip');
                showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${itemsToDownload.length} Ø¹Ù†ØµØ± ÙÙŠ Ø­Ø²Ù…Ø© ZIP <i class="bi bi-file-zip-fill ms-2" aria-hidden="true"></i>`, 'success');
            } catch (error) { showNotification('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ ZIP: ' + error.message, 'danger'); } finally { setTimeout(() => zipProgress.classList.add('d-none'), 2000); }
        }

        function copyToClipboard(type) {
            const itemsToCopy = getSelectedItems();
            if (itemsToCopy.length === 0) return showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ù„Ù†Ø³Ø®', 'warning');

            const dataMap = {
                all: () => JSON.stringify(getStrippedIndex(itemsToCopy), null, 2),
                titles: () => itemsToCopy.map(item => item.title).join('\n'),
                urls: () => itemsToCopy.map(item => item.url).join('\n'),
                descriptions: () => itemsToCopy.map(item => item.description).join('\n')
            };
            const content = dataMap[type]();
            navigator.clipboard.writeText(content).then(() => {
                showNotification(`ØªÙ… Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª ${itemsToCopy.length} Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©! <i class="bi bi-clipboard-check-fill ms-2" aria-hidden="true"></i>`, 'success');
                getEl('copyOptions').classList.add('d-none');
            }).catch(err => showNotification('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®!', 'danger'));
        }

        // --- NEW/REFACTORED Project Management ---
        const getProjectStorageKey = (projectName) => `searchIndexGenerator_${projectName}`;

        function getProjectList() {
            try {
                return JSON.parse(localStorage.getItem(PROJECTS_MASTER_KEY)) || [];
            } catch (e) {
                return [];
            }
        }

        function updateProjectListDropdown() {
            const projects = getProjectList();
            const selector = getEl('projectSelector');
            const currentProject = getEl('projectNameInput').value;
            selector.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ù‹Ø§ --</option>';
            projects.forEach(p => {
                const option = document.createElement('option');
                option.value = p;
                option.textContent = p;
                if (p === currentProject) {
                    option.selected = true;
                }
                selector.appendChild(option);
            });
        }
        
        function clearCurrentState() {
             Object.assign(appState, { searchIndex: [], manualPages: [], analyzedFiles: [], sitemapUrls: [], robotsUrls: [], manifestData: {}, filteredResults: [], selectedItemIds: new Set() });
            getEl('urlInput').value = '';
            getEl('customProxyUrl').value = '';
            getEl('projectNameInput').value = '';
            getEl('projectSelector').value = '';
            updateAllUI();
        }

        function loadProject(projectName) {
            if (!projectName) {
                clearCurrentState();
                return;
            }
            try {
                const storageKey = getProjectStorageKey(projectName);
                const savedData = localStorage.getItem(storageKey);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    Object.assign(appState, {
                        searchIndex: data.searchIndex || [],
                        manualPages: data.manualPages || [],
                        analyzedFiles: data.analyzedFiles || [],
                        sitemapUrls: data.sitemapUrls || [],
                        robotsUrls: data.robotsUrls || [],
                        manifestData: data.manifestData || {},
                        selectedItemIds: new Set()
                    });
                    getEl('urlInput').value = data.urlInput || '';
                    getEl('customProxyUrl').value = data.customProxyUrl || '';
                    getEl('projectNameInput').value = projectName;

                    localStorage.setItem(LAST_PROJECT_KEY, projectName);
                    updateAllUI();
                    updateProjectListDropdown();
                    showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹ "${projectName}"! <i class="bi bi-folder2-open ms-2" aria-hidden="true"></i>`, 'info');
                }
            } catch (error) { showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ' + error.message, 'warning'); }
        }

        function saveProject() {
            const projectName = getEl('projectNameInput').value.trim();
            if (!projectName) {
                return showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.', 'danger');
            }

            const filesToSave = appState.analyzedFiles.map(({ content, ...rest }) => rest);
            const data = {
                searchIndex: appState.searchIndex,
                manualPages: appState.manualPages,
                analyzedFiles: filesToSave,
                sitemapUrls: appState.sitemapUrls,
                robotsUrls: appState.robotsUrls,
                manifestData: appState.manifestData,
                urlInput: getEl('urlInput').value,
                customProxyUrl: getEl('customProxyUrl').value,
                timestamp: new Date().toISOString()
            };
            try {
                const storageKey = getProjectStorageKey(projectName);
                localStorage.setItem(storageKey, JSON.stringify(data));
                
                // Update master project list
                let projects = getProjectList();
                if (!projects.includes(projectName)) {
                    projects.push(projectName);
                    localStorage.setItem(PROJECTS_MASTER_KEY, JSON.stringify(projects));
                }
                
                localStorage.setItem(LAST_PROJECT_KEY, projectName);
                updateProjectListDropdown();
                showNotification(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${projectName}" Ø¨Ù†Ø¬Ø§Ø­! <i class="bi bi-save-fill ms-2" aria-hidden="true"></i>`, 'success');

            } catch (error) {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©. ' + error.message, 'danger');
            }
        }

        function deleteSelectedProject() {
            const projectName = getEl('projectSelector').value;
            if (!projectName) {
                return showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø­Ø°ÙÙ‡.', 'warning');
            }
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${projectName}"ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`)) {
                // Remove project data
                localStorage.removeItem(getProjectStorageKey(projectName));
                
                // Update master list
                let projects = getProjectList();
                const newProjects = projects.filter(p => p !== projectName);
                localStorage.setItem(PROJECTS_MASTER_KEY, JSON.stringify(newProjects));
                
                // Clear UI if the deleted project was the current one
                if (getEl('projectNameInput').value === projectName) {
                    clearCurrentState();
                }

                updateProjectListDropdown();
                showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${projectName}" Ø¨Ù†Ø¬Ø§Ø­! <i class="bi bi-trash3-fill ms-2" aria-hidden="true"></i>`, 'success');
            }
        }

        function loadLastProject() {
            const lastProject = localStorage.getItem(LAST_PROJECT_KEY);
            if(lastProject) {
                loadProject(lastProject);
            }
        }

        // --- END Project Management ---

        async function processHtmlFiles(files) {
            const progressContainer = getEl('progressContainer');
            const progressBar = getEl('progressBar');
            const progressText = getEl('progressText');
            progressContainer.classList.remove('d-none');
            const newAnalyzedFiles = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                progressBar.style.width = `${((i + 1) / files.length) * 100}%`;
                progressText.textContent = `Ù…Ø¹Ø§Ù„Ø¬Ø© ${file.name} (${i + 1}/${files.length})`;
                if (!appState.analyzedFiles.find(f => f.filename === file.name)) {
                    try {
                        const analysis = analyzeHtmlContent(await readFileContent(file), file.name);
                        appState.analyzedFiles.push(analysis);
                        newAnalyzedFiles.push(analysis);
                    } catch (error) { console.error('Error processing file:', file.name, error); showNotification(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù ${file.name}`, 'danger'); }
                }
                await new Promise(r => setTimeout(r, 50));
            }
            progressContainer.classList.add('d-none');
            if (newAnalyzedFiles.length > 0) { showNotification(`ØªÙ… ØªØ­Ù„ÙŠÙ„ ${newAnalyzedFiles.length} Ù…Ù„Ù HTML Ø¬Ø¯ÙŠØ¯! Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${appState.analyzedFiles.length} ğŸ‰`, 'success'); }
            else { showNotification('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'info'); }
            saveProject();
        }

        function toggleCopyOptions() { getEl('copyOptions').classList.toggle('d-none'); }
        
        async function analyzeSpaSite() {
            const urlInput = getEl('spaUrl');
            const url = urlInput.value.trim();
            if (!url) { return showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„ØªØ­Ù„ÙŠÙ„', 'warning'); }
            showNotification(`ğŸ”¬ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ ${url}...`, 'info');
            try {
                const response = await fetch(getProxyUrl(url));
                if (!response.ok) { throw new Error(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Status: ${response.status})`); }
                const html = await response.text();
                
                const analysis = analyzeHtmlContent(html, url);
                const newItem = {
                    title: analysis.title, description: analysis.description, url: url,
                    category: 'ØªØ­Ù„ÙŠÙ„ SPA', tags: extractTagsFromUrl(url),
                    source: 'spa_analysis', seo: analysis.seo
                };

                const addedCount = addItemsToIndex([newItem]);
                if(addedCount > 0){
                    showNotification(`âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ù†ØªØ§Ø¦Ø¬.`, 'success');
                    updateAllUI();
                    saveProject();
                } else {
                    showNotification('ØªÙ… ØªØ­Ù„ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆÙ‡Ùˆ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.', 'info');
                }

            } catch (error) { console.error('SPA Analysis Error:', error); showNotification(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${error.message}`, 'danger'); }
        }
        
        async function processRobotsFile(file) {
            try {
                const content = await readFileContent(file); const lines = content.split('\n').map(l => l.trim());
                const newRobotsUrls = lines.filter(l => l.toLowerCase().startsWith('disallow:') || l.toLowerCase().startsWith('allow:')).map(l => l.split(':')[1]?.trim()).filter(Boolean);
                if (newRobotsUrls.length > 0) {
                    appState.robotsUrls.push(...newRobotsUrls); const urlInput = getEl('urlInput'); urlInput.value = (urlInput.value ? urlInput.value + '\n' : '') + newRobotsUrls.join('\n');
                    showNotification(`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${newRobotsUrls.length} Ù…Ø³Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ù† robots.txt! <i class="bi bi-robot ms-2" aria-hidden="true"></i>`, 'success'); saveProject();
                } else { showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ù„Ù robots.txt', 'warning'); }
            } catch (error) { showNotification('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù robots.txt: ' + error.message, 'danger'); }
        }
        async function processManifestFile(file) {
            try {
                const content = await readFileContent(file);
                appState.manifestData = JSON.parse(content);
                const extractedUrls = [ ...(appState.manifestData.icons?.map(i => i.src) || []), ...(appState.manifestData.screenshots?.map(s => s.src) || []), appState.manifestData.start_url, ...(appState.manifestData.shortcuts?.map(s => s.url) || []) ].filter(Boolean);
                if (extractedUrls.length > 0) {
                    const urlInput = getEl('urlInput'); urlInput.value = (urlInput.value ? urlInput.value + '\n' : '') + extractedUrls.join('\n');
                    showNotification(`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${extractedUrls.length} Ù…Ø³Ø§Ø± Ù…Ù† manifest.json! <i class="bi bi-pwa ms-2" aria-hidden="true"></i>`, 'success'); saveProject();
                } else { showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø±Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ù…Ù„Ù manifest.json', 'warning'); }
            } catch (error) {
                if (error instanceof SyntaxError) {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Manifest: ØªÙ†Ø³ÙŠÙ‚ JSON ØºÙŠØ± ØµØ§Ù„Ø­.', 'danger');
                } else {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù manifest.json: ' + error.message, 'danger');
                }
            }
        }
        function setupTextareaDragDrop() {
            const textarea = getEl('urlInput'); textarea.addEventListener('dragover', (e) => { e.preventDefault(); textarea.classList.add('dragover'); });
            textarea.addEventListener('dragleave', () => textarea.classList.remove('dragover'));
            textarea.addEventListener('drop', (e) => { e.preventDefault(); textarea.classList.remove('dragover'); const files = Array.from(e.dataTransfer.files).filter(file => /\.txt|\.json$/.test(file.name)); if (files.length > 0) processDroppedTextFiles(files); });
        }
        async function processDroppedTextFiles(files) {
            for (const file of files) {
                try {
                    const content = await readFileContent(file);
                    let urls = file.name.endsWith('.json') ? (JSON.parse(content).urls || JSON.parse(content)) : content.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));
                    if (Array.isArray(urls) && urls.length > 0) {
                        const urlInput = getEl('urlInput'); urlInput.value = (urlInput.value ? urlInput.value + '\n' : '') + urls.join('\n');
                        showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${urls.length} Ø±Ø§Ø¨Ø· Ù…Ù† ${file.name}! <i class="bi bi-download ms-2" aria-hidden="true"></i>`, 'success'); saveProject();
                    }
                } catch (error) { showNotification(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© ${file.name}: ${error.message}`, 'danger'); }
            }
        }
        
        function showNotification(message, type = 'info', duration = 5000) {
            const toastContainer = document.querySelector('.toast-container'); const toastId = 'toast-' + Date.now();
            const typeMapping = { 'info': 'bg-info', 'success': 'bg-success', 'warning': 'bg-warning', 'danger': 'bg-danger' };
            const toast = document.createElement('div'); toast.id = toastId; toast.className = `toast align-items-center ${typeMapping[type]} text-white border-0`;
            toast.setAttribute('role', 'alert'); toast.setAttribute('aria-live', 'assertive'); toast.setAttribute('aria-atomic', 'true');
            // IMPROVED: RTL-aware close button layout for better appearance.
            toast.innerHTML = `<div class="d-flex align-items-center">
                                 <div class="toast-body flex-grow-1">${message}</div>
                                 <button type="button" class="btn-close btn-close-white me-2" data-bs-dismiss="toast" aria-label="Close"></button>
                               </div>`;
            toastContainer.appendChild(toast); const bsToast = new bootstrap.Toast(toast, { delay: duration }); bsToast.show(); toast.addEventListener('hidden.bs.toast', () => toast.remove());
        }
        async function processSitemapFile(file) {
            try {
                const content = await readFileContent(file); const xmlDoc = new DOMParser().parseFromString(content, 'text/xml');
                if (xmlDoc.querySelector('parsererror')) throw new Error('ØªÙ†Ø³ÙŠÙ‚ XML ØºÙŠØ± ØµØ§Ù„Ø­.');
                const newSitemapUrls = [...xmlDoc.querySelectorAll('url > loc, sitemap > loc')].map(el => { try { return new URL(el.textContent.trim()).pathname; } catch { return el.textContent.trim(); } }).filter(Boolean);
                if (newSitemapUrls.length > 0) {
                    appState.sitemapUrls.push(...newSitemapUrls); const urlInput = getEl('urlInput'); urlInput.value = (urlInput.value ? urlInput.value + '\n' : '') + newSitemapUrls.join('\n');
                    showNotification(`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${newSitemapUrls.length} Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù…Ù† Sitemap! <i class="bi bi-map-fill ms-2" aria-hidden="true"></i>`, 'success'); saveProject();
                } else { showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ù„Ù Sitemap', 'warning'); }
            } catch (error) { showNotification('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Sitemap: ' + error.message, 'danger'); }
        }
        function readFileContent(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = e => resolve(e.target.result); reader.onerror = reject; reader.readAsText(file, 'UTF-8'); }); }
        
        function extractTagsFromUrl(url) {
            if (!url) return [];
            // Make it robust for both absolute and relative URLs
            try {
                const dummyBase = url.startsWith('http') ? undefined : 'http://dummy.com';
                const pathParts = new URL(url, dummyBase).pathname.split('/').filter(p => p && p !== '');
                const tags = pathParts.flatMap(part => part.replace(/\.[^/.]+$/, '').split(/[-_\s]+/)).filter(p => p.length > 2).map(p => p.toLowerCase());
                const translations = { 'index': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'about': 'Ù…Ù† Ù†Ø­Ù†', 'contact': 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', 'services': 'Ø®Ø¯Ù…Ø§Øª', 'products': 'Ù…Ù†ØªØ¬Ø§Øª', 'blog': 'Ù…Ø¯ÙˆÙ†Ø©', 'news': 'Ø£Ø®Ø¨Ø§Ø±', 'portfolio': 'Ø£Ø¹Ù…Ø§Ù„', 'team': 'ÙØ±ÙŠÙ‚', 'pricing': 'Ø£Ø³Ø¹Ø§Ø±', 'faq': 'Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©' };
                tags.forEach(tag => { if (translations[tag]) tags.push(translations[tag]); }); return [...new Set(tags)];
            } catch(e) {
                console.error("Could not parse URL for tags:", url, e);
                return [];
            }
        }
        function importUrlsFile() { const file = getEl('urlsFileInput').files[0]; if (!file) { return showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'warning'); } processDroppedTextFiles([file]); }
        
        function addManualPage() {
            const [title, url, description, category, tagsValue] = ['pageTitle', 'pageUrl', 'pageDescription', 'pageCategory', 'pageTags'].map(id => getEl(id).value);
            if (!title || !url) return showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'warning');
            appState.manualPages.push({ title, url: url.startsWith('/') ? url : '/' + url, description, category: category || 'Ø¹Ø§Ù…', tags: tagsValue.split(',').map(t => t.trim()).filter(Boolean) });
            ['pageTitle', 'pageUrl', 'pageDescription', 'pageCategory', 'pageTags'].forEach(id => getEl(id).value = ''); showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ©: ${title} ÙŠØ¯ÙˆÙŠÙ‹Ø§. Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯" Ù„Ø¥Ø¸Ù‡Ø§Ø±Ù‡Ø§.`, 'success'); saveProject();
        }
        function toggleEdit(itemId) {
            const pageItem = document.querySelector(`[data-id="${itemId}"]`); const editBtn = pageItem.querySelector('.btn-edit');
            const isEditing = editBtn.textContent === 'Ø­ÙØ¸'; pageItem.querySelectorAll('.editable-content').forEach(el => el.setAttribute('contenteditable', !isEditing));
            editBtn.textContent = isEditing ? 'Ø­ÙØ¸' : 'ØªØ­Ø±ÙŠØ±'; editBtn.classList.toggle('btn-outline-secondary', isEditing); editBtn.classList.toggle('btn-success', !isEditing);
            if (isEditing) {
                const item = appState.searchIndex.find(i => i.id === itemId); if (!item) return;
                pageItem.querySelectorAll('.editable-content').forEach(el => {
                    const field = el.dataset.field; const value = el.textContent.trim();
                    item[field] = field === 'tags' ? value.split(',').map(t => t.trim()).filter(Boolean) : value;
                }); showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª! <i class="bi bi-check-lg ms-2" aria-hidden="true"></i>', 'success'); updateStatistics(); saveProject();
            }
        }
        
        const downloadFile = (blob, filename) => { const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href); };
        
        // --- App Initialization ---
        function init() {
            setDarkMode(isDarkMode);
            updateProjectListDropdown();
            loadLastProject();

            // Setup event listeners
            getEl('darkModeToggle').addEventListener('click', toggleDarkMode);
            getEl('startCrawlerBtn').addEventListener('click', startSeoCrawler);
            getEl('analyzeSpaBtn').addEventListener('click', analyzeSpaSite);
            getEl('importUrlsFileBtn').addEventListener('click', importUrlsFile);
            getEl('addManualPageBtn').addEventListener('click', addManualPage);
            getEl('generateIndexBtn').addEventListener('click', handleGenerateClick);
            getEl('selectAllBtn').addEventListener('click', selectAllItems);
            getEl('deselectAllBtn').addEventListener('click', deselectAllItems);
            getEl('downloadJsonBtn').addEventListener('click', downloadJson);
            getEl('downloadCsvBtn').addEventListener('click', downloadCSV);
            getEl('downloadZipBtn').addEventListener('click', downloadZip);
            getEl('toggleCopyBtn').addEventListener('click', toggleCopyOptions);
            
            // New Project Management Listeners
            getEl('saveProjectBtn').addEventListener('click', saveProject);
            getEl('projectSelector').addEventListener('change', (e) => loadProject(e.target.value));
            getEl('deleteProjectBtn').addEventListener('click', deleteSelectedProject);
            getEl('clearFormBtn').addEventListener('click', () => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ')) {
                    clearCurrentState();
                    showNotification('ØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡. Ø£Ù†Øª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡!', 'info');
                }
            });

            getEl('manualInput').addEventListener('change', function() { getEl('manualInputSection').classList.toggle('d-none', !this.checked); });
            getEl('hideCrawlerStatusBtn').addEventListener('click', () => getEl('crawlerStatus').classList.add('d-none'));

            // Event delegation for dynamic content
            getEl('results').addEventListener('click', function(e) {
                const target = e.target;
                const resultItem = target.closest('.result-item');
                if (!resultItem) return;

                const itemId = parseInt(resultItem.dataset.id, 10);
                if (target.classList.contains('btn-edit')) {
                    toggleEdit(itemId);
                } else if (target.classList.contains('item-select-checkbox')) {
                    toggleItemSelection(target, itemId);
                }
            });

            getEl('copyOptions').addEventListener('click', function(e) {
                const button = e.target.closest('button[data-copy-type]');
                if (button) copyToClipboard(button.dataset.copyType);
            });

            const setupDragDrop = (dropZoneId, fileInputId, fileTypeRegex, processFunction) => {
                const dropZone = getEl(dropZoneId); const fileInput = getEl(fileInputId); if (!dropZone || !fileInput) return;
                dropZone.addEventListener('click', () => fileInput.click()); dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
                dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
                dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('dragover'); const files = Array.from(e.dataTransfer.files).filter(file => fileTypeRegex.test(file.type) || fileTypeRegex.test(file.name)); if (files.length > 0) processFunction(fileInput.multiple ? files : files[0]); });
                fileInput.addEventListener('change', (e) => { if (e.target.files.length > 0) processFunction(fileInput.multiple ? Array.from(e.target.files) : e.target.files[0]); });
            };
            
            setupDragDrop('robotsDropZone', 'robotsFileInput', /\.txt$/, processRobotsFile); 
            setupDragDrop('manifestDropZone', 'manifestFileInput', /\.json$/, processManifestFile);
            setupDragDrop('sitemapDropZone', 'sitemapFileInput', /\.xml$/, processSitemapFile); 
            setupDragDrop('fileDropZone', 'htmlFileInput', /\.html?$/, processHtmlFiles);
            setupTextareaDragDrop(); 
            setupFilters();
        }

        window.addEventListener('DOMContentLoaded', init);

    })(); // End of IIFE
    </script>
</body>
</html>